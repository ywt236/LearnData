# 操作系统

[TOC]

## 第一章   操作系统引论

### 操作系统目标

* 方便性
* 有效性
* 可扩充性
* 开放性

### 操作系统的作用

* OS为用户和硬件系统之间的接口
  * 命令方式
  * 系统调用方式
  * 图标----窗口方式
* OS为计算机系统资源的管理者
  * 处理机资源
  * 存储器资源
  * IO设备资源
  * 文件资源
* OS实现了对计算机资源的抽象
  * 覆盖软件，提供抽象模型，按接口使用计算机

### 推动操作系统发展的动力

* 不断提高计算机资源利用率
* 方便用户
* 器件不断更新换代
* 计算机体系结构不断发展
* 不断提出新的应用需求

### 操作系统的发展过程

* #### 未配置操作系统的计算机系统
  
  * 人工操作方式
    * 用户独占主机
    * CPU等待人工操作
  * 脱机输入方式
    * 脱离主机方式下，进行输入输出，反之叫联机输入输出方式
    * 减少了CPU等待时间
    * 提高了IO速度
  
* #### 单批道处理系统
  
  * 处理完一个任务接着处理下一个作业
  * 缺点
    * 系统资源得不到充分利用，当运行程序进行IO处理时，CPU进行等待
  
* #### 多批道处理系统
  
  * 多道程序排成一个后备队列，每次调入若干个作业，当程序A，利用I/O操作而暂停执行CPU空挡时间，调度另一道程序
  * 优缺点
    * 资源利用率高
    * 系统吞吐量大    
    * 平均周转时间长  排队处理，因此周期时间长
    * 无用户交互能力
  * 多道批处理系统需解决的问题
    * 处理机争用问题
    * 内存分配和保护问题
    * IO设备分配问题
    * 文件的组织与管理问题
    * 作业管理问题
    * 用户与系统的接口问题
  
* #### 分时系统
  
  * 推动多道批处理的动力是提高资源利用率和系统吞吐量，推动分时系统的动力是满足人机交互能力和共享主机
  * 为实现交互能力，必须及时接受，及时处理
  
  * 作业存入内存，采用轮转运行方式，每一个作业单独CPU运行一个时间片，然后暂停，立即调度下一个作业
  * 特征
    * 多路性    许多用户共享一台主机
    * 独立性    每个用户作业互不干扰
    * 及时性    用户请求及时得到处理
    * 交互性    请求系统提供多方面服务
  
* #### 实时系统
  
  * 实时表示及时，能及时响应外部事件请求，在规定时间内完成事件的处理，控制所有实时任务协调运行
  * 实时系统的类型
    * 工业控制系统    
    * 信息查询系统
    * 多媒体系统
    * 嵌入式系统
  * 实时任务的类型
    * 周期性实时任务与非周期性实时任务
    * 硬实时任务和软实时任务
  * 特征
    * 多路性
    * 独立性
    * 及时性
    * 交互性
    * 可靠性
  
* #### 微机操作系统
  
  * 单用户单任务操作系统
    * 只允许一个用户上机，一个程序运行
    * CP/M  MS-DOS
  * 单用户多任务操作系统
    * 一个用户上机，多个任务执行
    * WINDOWS
  * 多用户多任务操作系统
    * 多个用户使用一台主机，共享资源
    * UNIX LINUX



### 操作系统的基本特征

* 并发
  * 并行  多个事件在同一时刻发生
  * 并发  在一段时间内宏观上有多个程序同时运行
  * 进程  在系统中能独立运行并作为资源分配的活动实体，由一组机器指令，数据，堆栈组成
* 共享
  * 系统中的资源可供内存中多个并发执行的进程共同使用
  * 并发与共享是多用户OS的基本特征
  * 共享方式
    * 互斥共享方式 在一段时间内只允许一个进程访问该资源
    * 同时访问方式  宏观上对一资源同时访问 微观上交替访问
* 虚拟
  * 时分复用技术  
    * 虚拟处理机技术    为每一程序创建进程，多道程序并发执行，用户感觉有一个专门的处理机为它服务
    * 虚拟设备技术       允许多个用户在一段时间内访问
  * 空分复用技术  
    * 利用存储器的空闲区域存放和运行其他多道程序，提高存储器利用率
    * 应用虚拟存储技术扩大存储器容量
* 异步
  * 由于进程以不可预知的速度推进，即程序有异步性

### 操作系统的主要功能

* 处理机管理功能

  * 进程控制    为作业创建进程，撤销进程，控制进程状态转换，在设有线程的系统，还包括为进程创建线程
  * 进程同步    对多个进程的运行进行协调，方式有：1.进程互斥方式 进程对临界资源访问   2.进程同步方式  相互合作完成共同任务的诸进程，进行协调
  * 进程通信    实现相互合作进程之间的通信，与信息交换
  * 调度    
    * 作业调度    基本任务是从后备队列中按照一定算法选择出若干个作业，使其进入就绪进程
    * 进程调度    从进程的就绪队列中按照一定算法选出一个进程，将处理机分配给它

* 存储器管理功能 

  * 内存分配    
    * 静态分配方式    不允许作业再申请新的内存空间
    * 动态分配方式    允许继续申请新的附加空间，以适应程序和数据的动态增长
  * 内存保护    
    * 确保每道用户程序在自己的空间内运行，彼此不干扰
    * 不允许用户程序访问系统的程序与数据，不允许用户转移到非共享的其他程序中
  * 地址映射    地址空间中的逻辑地址转换为内存空间的物理地址
  * 内存扩充    
    * 借助虚拟存储技术，从逻辑上扩充内存容量
    * 置换功能
    * 请求调入功能

* 设备管理功能

  * 完成指定IO请求
  * 提高CPU和IO设备的利用率

  * 缓冲管理    CPU与IO设备中设置缓存，缓解设备间速度不匹配的问题
  * 设备分配    根据用户进程的IO请求，现有资源，为进程分配所需设备
  * 设备处理    驱动程序，用于实现CPU和设备控制器之间的通信

* 文件管理功能

  * 文件存储空间管理    为文件分配必要的外存空间，提高外存利用率
  * 目录管理    为文件创建目录项，有效组织文件
  * 文件读写管理和保护    对文件进行读写和提供有效的存取控制功能

* 与用户之间的接口功能

  * 用户接口
    * 联机用户接口
    * 脱机用户接口
    * 图形用户接口
  * 程序接口
    * 用户程序在执行中访问系统资源设置的

* 新功能

  * 系统安全

    * 认证技术
  * 密码技术
    
    * 访问控制技术
  * 反病毒技术
  
  * 网络服务
  
    * 网络通信
    * 资源管理
    * 应用互操作
  
  * 支持多媒体
  
    

### OS结构设计

* #### 无结构操作系统

  * 也称为整体系统结构

* #### 模块化操作系统

  * 功能精心划分为若干个具有独立性和大小的模块
  * 优缺点
    * 提高正确性和可维护性
    * 无序性，难以满足接口的实际需求

* #### 分层式结构OS

  * 采用自底向上法铺设中间层
  * 优缺点
    * 易保证系统的正确性
    * 易扩充和维护
    * 系统效率低，分层单向依赖

* #### 微内核OS结构

  * 基本概念
    * 足够小的内核，能实现最基本核心功能的小型内核
      * 与硬件相关
      * 较基本功能
      * 客户与服务器通信
    * 基于客户/服务器模式
    * 机制与策略分离原理 
    * 面向对象技术
  * 微内核基本功能
    * 进程管理
    * 低级存储器管理
    * 中断和陷入处理
  * 操作系统的优点
    * 提高系统扩展性
    * 增强系统可靠性
    * 可移植性强
    * 对分布式系统的支持
    * 融入面向对象技术
  * 操作系统缺点
    * 运行效率有所降低，增加了上下文切换



## 第二章 进程的描述与控制

### 前趋图

* 用于描述程序执行先后顺序的前趋图，p1->p2  说明p2执行前p1一定要执行完
* 没有前趋的结点称为初始结点  
* 没有后续的结点称为终止结点  
* 每一结点还具有一个重量，表示该结点程序执行的时间  
* 结点之间不存在循环  

### 程序顺序执行

* 在执行时，都需要按照某种先后顺序执行，前一段执行后，才能运行后一段
* 顺序执行的特征
  * 顺序性    每一个操作必须在下一操作开始之前结束
  * 封闭性    程序运行时独占全机资源
  * 可再现性    程序执行环境和初始条件相同，所获得结果相同

### 程序并发执行

* 只有不存在前趋关系的程序之间能并发执行
* 并发执行的特征
  * 间断性    并发程序具有“执行--暂停--执行”这种间断性的活动规律
  * 无封闭性    系统的资源为他们所共享
  * 不可再现性    计算结果与并发程序的执行速度有关

### 进程的定义

* 为使参与并发的执行的每个程序都能独立运行，操作系统中为之配置一个专门的数据结构，称为进程控制块

* 由程序段，相关的数据段，PCB三部分便构成了进程实体（进程）

* 进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单元

* #### 进程的特征
  
  * 动态性    是执行过程
  * 并发性    多个进程实体存在与内存中
  * 独立性    进程实体是能独立运行，独立获得资源和独立接收调度的基本单位
  * 异步性    进程是按异步方式进行的，各自独立，不可预知的速度执行
  
* ##### 进程的基本状态及转换
  
  * 三种基本状态
    * 就绪状态    进程已处于准备运行的状态，分配到除CPU外的必要资源，按一定策略排成一个队列，称为就绪队列
    * 执行状态    已获得CPU，正在执行的状态，对于单处理机系统，一个进程在执行，对于多处理机系统，多个进程在执行
    * 阻塞状态    正在执行的进程因发生某事件暂停执行（IO，申请缓冲区失败等）
  * 三种状态的转换    p40
  * 创建状态
    * 进程由创建而产生，一般步骤为申请空白的PCB，向PCB中填写用于控制和管理进程的信息，为进程分配必须的资源，转入就绪状态的队列中
    * 创建状态是为了保证进程的调度在创建工作后完成后进行
  * 终止状态
    * 步骤首先等待系统进行善后处理，最后将PCB空间清零，并将空间返回系统
  * 挂起操作
    * 进程处于静止状态，如果在执行则暂停，处于就绪则不被调用，方便系统和用户观察
    * 挂起操作引入的原因    p41
    * 与挂起操作对应的是激活操作
  * 引入挂起和激活操作后三个进程状态之间的转化    
    * P42
  
* ##### 进程管理中的数据结构
  
  * 用户利用数据结构及操作命令执行相关操作
  
  * 记录和查询各类资源的使用与进程运行情况
  
  * ##### 操作系统中用于管理和控制的数据结构
    
    * OS管理的数据结构分为四类：内存表，设备表，文件表，进程表（PCB）
    * ###### PCB
      
      * 每个进程定义了一个数据结构PCB，作为进程实体的一部分，描述进程当前状态及管理进程的全部信息
      * 作用    使不能独立运行的程序成为一个独立运行的基本单位，能并发执行的进程
      * 具体作用 
        * 作为独立运行基本单位的标志，程序配置PCB后成为能独立运行的单位
        * 实现间断性运动方式，系统将进程运行时CPU的信息存入PCB，使进程有可再现性
        * 提供进程管理所需的信息，PCB记录程序和数据的始址指针，找到相应的程序和数据。访问文件系统和IO设备时也要借助PCB中的信息。了解资源清单。
        * 提供进程调度所需的信息。如状态，优先级等
        * 实现与其他进程的同步与通信
      * ###### 进程控制块中的信息
        
        * 进程标识符
          * 外部标识符    方便用户访问
          * 内部标识符    方便系统对进程的使用
        * 处理机状态    
          * 处理机的各种寄存器内容组成   通用寄存器  指令寄存器  PSW状态寄存器  用户栈指针
          * 进程切换时，处理机状态存储在PCB中供下次使用
        * 进程调度信息
          * 包括  进程状态  进程优先级  其他信息  事件，即阻塞原因
        * 进程控制信息
          * 程序和数据的地址
          * 同步与通信机制
          * 资源清单
          * 链接指针，本进程到下一进程的地址
      * ###### 进程控制块的组织方式
        
        * 线性方式
          * 顺序存放在专属内存区域，简单，开销小，但每次需扫描全表
          * 适合进程数不多的系统
        * 链接方式
          * 把相同状态的进程连接在一起，如就绪队列，阻塞队列，空白队列
          * 可按优先级，阻塞原因分类形成队列
        * 索引方式
          * 建立索引表，记录进程位置
  
* #### 进程控制

  * 功能包括  创建新进程，终止已完成进程，将状态进行转变 

  * 进程控制一般是由OS的原语实现的

  * ##### 操作系统的内核

    * 将一些与硬件相关的模块，各种常用的驱动程序，运行频率高的模块 常驻在内存中 常称为OS内核
    * 处理机的运行状态
      * 系统态，管态，具有较高的特权，执行一切命令，访问所有存储器与存储区
      * 用户态，目态，执行规定命令，访问指定的存储器和存储区
    * OS内核两大功能
      * 支撑功能（最基本的功能，提供给其它模块）
        * 中断处理    
        * 时钟管理    时间片轮转调度
        * 原语操作    不可分割的基本单位，要么做，要么不做，在执行过程中不能被打断
      * 资源管理功能
        * 进程管理
        * 存储器管理
        * 设备管理

  * ##### 进程的创建

    * 进程的层次结构

      * 在OS中，允许一个进程创建另一个进程，创建进程的进程为父进程，被创造的进程为子进程
      * 子进程可以继承父进程的资源，继承父进程分配到的缓冲区，父进程撤销时，子进程也被撤销
      * 在windows系统中不存在进程层次结构，所有进程具有相同地位，根据句柄判断控制权

    * 进程图

      * 描述进程关系的有向树，每一结点为进程
      * 创建父进程的进程为祖先进程，根进程为祖先

    * 引起创建进程的事件

      * 用户登录，用户登录后，为其创建一个进程，插入到队列中
      * 作业调度，将作业装入内存，为他们创建进程，放入就绪进程队列
      * 提供服务，系统创建一个进程提供服务
      * 应用请求，用户自己定义

    * 进程的创建

      * 申请空白PCB，获得唯一标识符

      * 为进程分配其运行所需的资源，如内存，文件，IO设备，CPU时间等，仅从父进程中获取

      * 初始化PCB，如标识符，处理机状态，处理机控制信息

      * 插入就绪队列中

        

      * ##### 进程的终止

      * 引起终止的事件
        * 正常结束，表示任务完成，准备退出，由程序安排指令，指示退出
        * 异常结束，运行时发生的异常事件，P50
        * 外界干预，P50
      * 进程的终止过程
        * 找到要终止进程，读出状态
        * 若还在执行，则终止执行
        * 若有子孙进程，一并终止
        * 资源归还给其父进程或系统
        * 进程从队列中移除

    * ##### 进程的阻塞与唤起

      * 阻塞事件
        * 向系统请求资源失败
        * 等待某种操作
        * 新数据未到达
        * 等待新任务的到达
      * 阻塞过程
        * 阻塞为进程本身行为，停止运行，插入阻塞队列
      * 唤醒过程
        * 将进程状态改变，移除阻塞队列，插入到就绪队列

    * ##### 进程的挂起与激活

      * 检测状态
      * 利用挂起原语suspend挂起，激活

* #### 进程同步

  * 对多个相关的进程在执行次序上进行协调，使并发执行的进程之间能按照一定规则共享系统资源，并很好的相互合作，从而使程序具有可再现性
  
  * ##### 两种制约关系
    
    * 间接相互制约关系
      * 由于一些临界资源的共享，形成的制约关系
    * 直接相互制约关系
      * 为完成某项任务而创建的两个或多个进程，制约关系源于他们之间的相互合作
    
  * ##### 临界资源
  
    * 如打印机，磁带机，诸进程应采取互斥方式，实现资源的共享
  
  * ##### 临界区
  
    * 访问一个临界资源的循环进程
      * while(TURE)
      * 进入区
      * 临界区
      * 退出区
      * 剩余区
  
  * ##### 同步机制应遵循的规则
  
    * 空闲让进
    * 忙则等待
    * 有限等待
    * 让权等待
  
  * ##### 同步的机制
  
    * 硬件同步机制
      * 提供一些特殊的硬件指令实现
      * 关中断
        * 临界区关闭中断
        * 缺点  P56
      * 利用Test-and-Set指令
      * 利用Swap实现进程互斥
    * 信号量机制
      * 整型信号量
      * 记录型信号量
      * and型信号量
      * 信号量集
    * 管程机制
      * 对于诸并发进程，可以根据情况接收或阻塞，确保每次仅有一个进程进入管程，执行对应过程，有效实现进程的互斥
      * 组成
        * 管程的名称
        * 管程的共享数据    (管程数据结构私有变量)
        * 对该数据结构的一组过程
        * 管程的初始化
      * 管程的特性   P64
      * 条件变量 
        * 用于记录进程被阻塞的原因
        * 将应其阻塞的进程插入x条件的队列中
  
* #### 进程通信

  * 进程之间的信息交换

  * 低级进程通信

    * 因进程之间的互斥与同步，进程之间交换的一些信息
    * 效率低，对用户不透明

  * 高级进程通信

    * ##### 共享存储器系统

      * 基于共享数据结构的通信方式     通信效率低下，属于低级通信
      * 基于共享存储区的通信方式    内存中划分出一块共享存储区域，诸进程可以对其读写交换信息

    * ##### 管道通信系统

      * 管道，又叫pipe文件，向管道写与读操作，有效地传输大量的数据
      * 互斥，读写不能同时进行
      * 同步
      * 确定通信双方的存在

    * ##### 消息传递系统

      * 进程不通过共享存储区或数据结构，而是将数据封装于消息中，利用操作系统的一组命令，在进程中进行消息的传送
      * 方式
        * 直接通信方式    直接发送给目标进程
        * 间接通信方式    通过共享实体(邮箱)进行发送

    * ##### 客户机-服务器系统

      * 套接字
        * 基于文件型    在同一台机器环境下，基于本地文件系统支持的，类似于管道
        * 基于网络型    
        * 不仅适用于同一台计算机，而且适用于不同计算机之间通信
      * 远程过程调用和远程方法调用
        * RPC，是一个通信协议，用于一台主机系统上的进程调用另一台系统上的进程，也可叫远程方法调用
        * 调用过程    p75
    
  * ##### 消息传递通信的实现方式
  
    * 直接消息传递系统
      * 发送进程直接利用OS提供的发送命令，把消息发送给目标进程
      * 通信原语
        * 对称寻址方式，通信双方提供对方的标识符
        * 非对称寻址方式，接收进程的原语中不需要对方的标识符
      * 消息格式
        * 定长与不定长
      * 进程的同步方式
        * 发送进程与接收进程的同步形式
      * 通信链路
        * 发送进程在通信之前显式声明一条通信链路，完成后拆除
        * 利用发送原语，系统自动建立一条链路
        * 链路有单向通信链路，双向通信链路
    * 信箱通信
      * 间接通信方式，需要通过某种中间实体来完成
      * 信箱结构
        * 信箱头，存放有关的信箱描述信息
        * 信箱体，由若干个存放消息的信箱格组成，数目及大小是在创建信箱时确定的
      * 信箱原语
        * 创建与撤销信箱
        * 消息的发送与接收
        * 类型
          * 私有邮箱，创建有权读取，其他进程只能发送，单向通信线路
          * 公有邮箱，所有进程都可使用
          * 共享邮箱，指定共享者
  
  * ##### 直接消息传递系统实例  p79
  
* #### 线程的基本概念

  * ##### 线程

    * 线程引入是为了程序有更好的并发性
    * 进程的两个基本属性，可拥用资源的独立单位，可独立调度和分派的基本单位

  * ##### 程序并发执行所需的时空开销

    * 创建进程，为其分配资源
    * 撤销进程，对资源进行回收，再撤销PCB
    * 进程切换，需保存CPU环境，设置新的CPU环境

  * ##### 线程作为调度和分派的基本单位

    * 将调度和分派的基本单位，与拥有资源的基本单位分开

  * ##### 进程与线程的比较

    * 调度的基本单位
      * 进程能独立运行，每次调度时要进行上下文切换，开销大
      * 线程是能独立运行的基本单位，切换代价小于进程
    * 并发性
      * 不同进程之间的线程都能并发执行，使OS拥有更好的并发性，提高系统资源利用率
    * 拥有资源
      * 进程拥有资源，线程本身不拥有资源
      * 线程可以共享进程的资源，如打开的文件，内存空间，IO设备等
    * 独立性
      * 进程的独立性比线程高
      * 线程的主要目的是提高并发性与相互之间的合作
    * 系统开销
      * 进程的创建与上下文切换都比线程开销大
    * 支持多处理机系统
      * 多线程可以分配到多个处理机上，使他们并发执行

  * ##### 线程的状态与线程控制块

    * 线程的三个状态：执行状态，就绪状态，阻塞状态
    * 线程控制块 TCB 
      * 线程标识符
      * 一组寄存器，PC计数器，状态寄存器，通用寄存器等
      * 线程运行状态
      * 优先级
      * 线程专有存储区
      * 信号屏蔽
      * 堆栈
    * 多线程OS中进程的属性
      * 进程是拥有资源的基本单位，为线程分配资源
      * 多个线程并发执行
      * 进程不再是可执行的实体

  * ##### 线程的实现方式

    * 内核支持线程（KST）
      * 线程的创建，阻塞，撤销，切换都是在内核空间中实现的
      * 优点    p85
      * 缺点    p86
    * 用户级线程（ULT）
      * 对线程的创建同步等功能不需内核支持，系统调度仍以进程为单位
      * 优点    p86
      * 缺点    p86
    * 组合方式
      * 组合方式中，同一进程的线程可以在多个处理机中运行，阻塞一个线程不需要将全部线程阻塞
      * 三种模型
        * 多对一 
        * 一对一
        * 多对多

  * ##### 线程的实现

    * 

  * ##### 线程的创建与终止



## 第三章  处理机调度与死锁

处理机调度：将处理机动态地分配给处于就绪状态的一个进程，使之执行

#### 处理机调度层次

* 高级调度
  * 作业调度，长程调度，调度对象为作业
  * 主要功能是将外存中的几个作业调入内存，为他们创建进程，分配资源，放入就绪队列中
  * 主要用在多道批处理系统中，分时与实时系统中不设置
  * 执行频率低，可花费较长时间
* 低级调度
  * 进程调度，短程调度
  * 主要功能为决定哪个进程获得处理机，并由分派程序将处理机分配给选中的进程
  * 最基本的调度，三种系统都需要配置
  * 执行频率高，调度算法不宜太复杂
* 中级调度
  * 内存调度
  * 将暂时不能运行的进程，调至外存等待，为挂起状态，当具备运行条件且内存又有空间时，由中级调度重新调入内存，状态变为就绪状态
  * 运行频率居中

#### 处理机调度算法的目标

* ##### 处理机调度算法的共同目标

  * 资源利用率    CPU利用率 = CPU有效时间/(CPU有效时间+CPU空闲时间)
  * 公平性    诸进程都获得合理的CPU时间，不会发生饥饿现象。相对公平性，对相同类型的进程获得相同服务，不同类型进程，提供不同服务
  * 平衡性    为使系统中CPU与外部设备常处于忙碌状态，调度算法尽可能保持系统资源使用的平衡性
  * 策略强制执行    策略需要则执行，即使某些工作被延迟

* ##### 批处理系统的目标

  * 平均周转时间短
    * 周转时间是指从作业被提交给系统开始，到作业完成的时间，包括作业在外存等待时间，进程在就绪队列等待时间，CPU执行时间，进程等待IO时间
    * 系统希望所有作业的平均周转时间最短
    * 平均周转时间：p94
    * 带权周转时间 p94
    * 平均带权周转时间：p94  反映作业（或进程）长短问题
  * 系统吞吐量高
    * 单位时间内系统所完成的作业数
  * 处理机利用率高
    * 处理机的利用率高

* ##### 分时系统目标

  * 响应时间快  响应时间为用户键盘提交一个请求开始，直到屏幕显示结果的时间
  * 均衡性    系统响应时间与用户请求服务的复杂性相适应 

* ##### 实时系统目标

  * 截止时间的保证
  * 可预测性，提高实时性

#### 作业与作业调度

* ##### 批处理系统中的作业

  * 作业包括通常的程序和数据，并配有作业说明书。在批处理系统中，是以作业为基本单位从外存调入内存的 
  
  * 作业步，在作业运行期间，每个作业运行期间需要几个步骤才能得到结果，通常为编译，链接装配，运行
  
  * ###### 作业控制块（JCB）
    
    * 包括作业标识，用户名称，用户账号，作业类型，作业状态，调度信息，资源需求，资源使用情况
    
  * ###### 作业运行的三个状态与三个阶段
    
    * 收容阶段（后备状态），为作业建立JCB，并放入后备队列中
    * 运行阶段（运行状态），作业被选中放入就绪队列，直至运行结束前
    * 完成阶段（完成状态），作业运行完成，进入完成阶段
    
  * ###### 作业调度的主要任务
    
    * 根据JCB的信息，检查系统中的资源是否满足作业对资源的需求，以及按照一定算法，从外存中选取某些作业调入内存，并为他们创建进程，分配资源，再将进程放在就绪队列上等待调度
    * 接纳多少作业
      * 从后备队列中选取多少调入内存，取决于多道程序度，即允许多少作业同时在内存中运行
    * 接纳哪些作业
      * 选择哪些作业调入内存，取决于调度算法，有短作业优先调度算法，基于优先级的调度算法，响应比高者优先算法等...
      * 批处理系统才需要作业调度，实时系统与分时系统采用某种接纳措施限制数量
    
  * ###### 先来先服务算法（FCFS）
    
    * 可用于作业调度，以及进程调度
    * 系统根据作业到达的先后次序进行调度，即等待最长时间的作业
    
  * ###### 短作业优先的调度算法（SJF）
    
    * 按作业的长短来计算优先级，作业越短，优先级越高
    * 缺点
    * 必须预知作业运行时间
      * 对长作业不利
    * 人机无法交互
      * 未考虑进程的紧迫程度
  
  * ###### 优先级调度算法(PSA)
  
    * 用于作业和进程调度
    
    * 基于作业的紧迫程度，由外部赋予，调度算法由该优先级进行调度
  
  * ###### 高响应比优先调度算法(HRRN)
  
    * 既考虑了作业的等待时间，也考虑了作业的运行时间
  * 优先权可以表示为：（等待时间+要求服务时间）/ 要求服务时间    (周转时间) / (要求服务时间)
    * FCFS与SJF的折中
    * 缺点是增加了计算响应比的时间
  
  #### 进程调度
  
  三种OS必不可少的调度，对系统性能影响最大，调度算法较多
  
  ##### 进程调度的任务
  
  * 保存处理机现场信息，如程序计数器，通用寄存器中的内容等
  * 按某种算法选取进程，按某种算法从就绪队列中选取一个进程，状态改为运行态
  * 把处理器分配给进程，处理器的控制权交予该进程
  
  ##### 进程调度的机制
  
  * 三个基本组成部分
    * 排队器  事先将系统中的所有就绪进程按照一定策略排成一个或多个队列
    * 分派器  将进程调度程序所选的进程，从就绪队列中选出
    * 上下文切换器  两对上下文切换操作
      * 保存当前进程的上下文，装入分派程序的上下文，以便分派程序运行
      * 移出分派程序上下文，把新选的进程装入到处理器中
  
  ##### 进程调度方式
  
  * 非抢占方式（不用于分时系统和多数实时系统）
  
    * 把处理器分配给某个进程后，一直让他运行下去，不会因为时钟中断或其他原因抢占当前处理器，直至进程完成，或阻塞
    * 引起进程调度的原因
      * 运行完成
      * 进程因IO请求暂停执行
      * 进程通信或同步，执行了某种原语操作，如block原语
  * 抢占方式
  
    * 允许调度方式根据某种原则，去暂停某个正在执行的进程，将已分配的处理机重新分配给另一进程
    * 优点
      * 避免长进程长时间占用处理机
      * 实现人机交互
      * 满足实时任务的需求
    * 缺点
      * 较麻烦，系统开销大
    * 抢占原则
      * 优先权原则，优先级高的进程可以抢占当前进程的处理机
      * 短进程原则，短进程可以抢占长进程的处理机
      * 时间片原则，根据时间片轮转运行
  * 轮转调度算法
  
    * 分时系统中，较常用的是基于时间片的轮转调度算法（RR）
    * 轮转法的基本原理
      * 根据FCFS策略，将所有的就绪进程排成一个就绪队列，每隔一定的时间间隔即产生一次中断，将CPU分配给队首的进程，由此确保所有进程在一个确定的时间内，获得一次执行
      * 进程的切换时机
        * 若时间片尚未完成，进程便结束，则立即激活进程调度程序，调度队首进程，启动一个新的时间片
        * 一个时间片用完，进程尚未结束，调度进程产生中断，将进程送往就绪队列的末尾
      * 时间片大小的确定
        * 不能太大，不能太小，，一般取时间片大小为略大于一次典型的交互所需的时间
  * 优先级调度算法
  
    * 把处理机分配给就绪队列中优先级最高的算法
  
    * 类型
      * 非抢占式优先级调度算法
      * 抢占式优先级调度算法    若在执行期间，出现了另一个优先级更高的进程，则产生中断，进行进程切换（可用于实时性操作系统）
    * 优先级类型
      * 静态优先级
        * 创建进程时确定的，运行过程中不变，利用某一范围内的一个整数来表示
        * 优先级大小依据
          * 进程类型    通常系统进程高于用户进程
          * 进程对资源的需求    对资源要求少的进程赋予较高的优先级
          * 用户要求    对进程的紧急程度，与用户所付费用确定
      * 动态优先级
        * 创建之初赋予一个优先级，其值随进程推进或等待时间的增加而改变，可防止长作业长期垄断处理机
  * 多队列调度算法
  
    * 将系统中的进程就绪队列从一个拆分为多个，不同的就绪队列采用不同的调度算法
    * 在多处理机系统中，安排多个就绪队列
  * 多级反馈队列调度算法（不需要知道执行时间）
  
    * 调度机制
      * 设置多个就绪队列，每个队列赋予不同的优先级，赋予不同的时间片大小
      * 每个队列为FCFS，新进程进入内存后，首先放入第一队列的队尾。若其在时间片内未完成，则放入第二队列的队尾，最后一个队列采用RR方式运行
      * 抢占式调度机制，当有新的高优先级的进程时，马上将正在运行的进程放在队列队尾
  * 基于公平原则的调度算法
    * 保证调度算法
      * 跟踪计算每一个进程自创建以来，已经执行的时间
      * 计算每个进程应获得的处理器时间
      * 计算(进程实际处理时间)/(应获得的处理机时间)
      * 比较各进程获得的比率
      * 选择比率最小的进程，将处理机分配给它，运行直到超过最接近它的进程比率
    * 公平分享调度算法
      * 针对用户的公平性，即所有的用户获得相同的处理机时间
  
  
  
  #### 实时调度
  
  * ##### 实现实时调度的基本条件
  
    * 提供必要信息
    * 系统处理能力强
    * 采用抢占式调度机制
    * 具有快速切换机制
  
  * ##### 实时调度算法的分类
  
    * 非抢占调度算法
      * 非抢占式轮转调度
      * 非抢占式优先调度
    * 抢占调度算法
      * 基于时钟中断的抢占式优先级调度算法
        * 抢占发生在时钟中断时
      * 立即抢占的优先级调度算法
        * 只要当前处理进程不在临界区，则抢占
  
  * 最早截止时间优先（EDF）
  
    * 截止时间越早，优先级越高，优先级越高则放入队首
    * 非抢占式EDF调度方式用于非周期实时任务 p108
    * 抢占式周期任务用于周期实时任务 p108
  
  * 最低松弛度优先LLF 算法
  
    * 确定优先级时，根据的是任务的紧急程度
    * 松弛度   ：结束截止时间-本身运行时间-当前时间
  
  * 优先级倒置算法
  
    * 优先级倒置的产生    p110
    * 解决优先级倒置的方法    p111
      * 进程在临界区不能被抢占
      * 动态优先级继承    较低优先级的进程继承较高优先级进程的优先级
  
  
  
  #### 死锁概述
  
  * 系统中引起死锁的主要是，互斥访问且不可被抢占的资源，即临界资源
  



## 第四章    存储器管理

存储器的性能指标

* 存储器速度
* 存储器容量
* 存储器价格便宜

存储器的多层结构

* CPU寄存器
  * 寄存器
* 主存储器
  * 高速缓存
  * 主存储器
  * 磁盘缓存
* 辅存
  * 固定磁盘
  * 可移动存储介质

可执行存储器：寄存器与主存储器

主存储器：用于保存进程运行时的程序和数据

寄存器：访问速度最快，容量小

高速缓存：用于备份主存中的内容，减少处理机对主存储器的访问次数

磁盘缓存：磁盘与主存之间的缓存

#### 程序的装入和链接

用户程序在系统中运行，必须先将它装入内存，再将其转变为一个可执行程序，通常步骤为

* 编译：由编译程序对用户源程序进行编译，形成若干目标模块
* 链接：由链接程序将编译后形成的一组目标模块以及库函数，形成完整的装入模块
* 装入：由装入程序将装入模块装入内存

##### 程序的装入

* 绝对装入方式
  * 事先在程序中设定绝对地址，适合单道程序环境
* 可重定位装入方式
  * 实际物理地址=逻辑地址+开始地址
  * 在进程装入时一次完成，以后不再改变，故称为静态重定位
  * 不允许程序运行时在内存中移动的位置

* 动态运行时装入方式
  * 地址转换推迟到程序真正要执行的时候

##### 程序的链接

* 静态链接方式
  * 各目标模块以及它们所需的库函数链接成一个完整的装配模块
  * 相对地址的修改
  * 
* 装入时动态链接
* 运行时动态链接





